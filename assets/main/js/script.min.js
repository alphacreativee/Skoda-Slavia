import{preloadImages}from"../../libs/utils.js";$=jQuery;let lenis=new Lenis;function heroSwiper(){document.querySelectorAll(".hero-swiper").forEach(e=>{let t;function i(n){n.pagination.bullets.forEach((e,t)=>{let i=e.querySelector(".progress-bar-swiper");t<n.realIndex?(e.classList.add("viewed"),e.classList.remove("swiper-pagination-bullet-active"),i.style.width="100%",i.style.transition="none"):t===n.realIndex?(e.classList.remove("viewed","swiper-pagination-bullet-active"),i.style.width="0%",i.style.transition="none",setTimeout(()=>{i.style.width="100%",i.style.transition=`width ${n.params.autoplay.delay}ms linear`,setTimeout(()=>{e.classList.add("viewed"),e.classList.add("swiper-pagination-bullet-active")},n.params.autoplay.delay)},50)):(e.classList.remove("viewed","swiper-pagination-bullet-active"),i.style.width="0%",i.style.transition="none")})}new Swiper(e,{slidesPerView:1,watchSlidesProgress:!0,speed:1500,loop:!0,autoplay:{delay:3e3},pagination:{el:e.querySelector(".swiper-pagination"),clickable:!0,renderBullet:function(e,t){return`
            <button class="${t}">
              <span class="progress-bar-swiper"></span>
            </button>`}},on:{init(e){i(e)},slideChangeTransitionStart(e){e.params.autoplay.delay=3e3,clearTimeout(t)},slideChangeTransitionEnd(e){i(e)},progress(i){i.slides.forEach(e=>{var t=(e.progress||0)*(.9*i.width),e=e.querySelector(".hero-img");e&&!isNaN(t)&&(e.style.transform=`translate3d(${t}px, 0, 0)`)})},touchStart(e){e.slides.forEach(e=>{e.style.transition=""}),clearTimeout(t)},setTransition(e,t){let i="cubic-bezier(0.25, 0.1, 0.25, 1)";e.slides.forEach(e=>{e.style.transition=t+"ms "+i;e=e.querySelector(".hero-img");e&&(e.style.transition=t+"ms "+i)})}}})})}function sectionDesign(){if(!($(".section-design").length<1)){$(".section-design .nav-tabs a").click(function(){var e=$(this).parent().position(),t=$(this).parent().width();$(".section-design .slider").css({left:+e.left,width:t})});var e=$(".section-design .nav-tabs").find(".active").parent("li").width(),t=$(".section-design .nav-tabs .active").position();if($(".section-design .slider").css({left:+t.left,width:e}),document.querySelector(".swiper-design-parallax")){let i=new Map;function n(e){var t=new Swiper(e,{centeredSlides:!0,slidesPerView:1.5,spaceBetween:24,speed:900,parallax:!0,loop:!0,loopedSlides:2,autoplay:{delay:2e3},pagination:{el:e.querySelector(".swiper-pagination"),type:"progressbar"},navigation:{nextEl:e.querySelector(".swiper-button-next"),prevEl:e.querySelector(".swiper-button-prev")},breakpoints:{991:{slidesPerView:1.5,spaceBetween:40,autoplay:!1}}});i.set(e,t)}document.querySelectorAll(".swiper-design-parallax").forEach(e=>{var t=e.closest(".tab-pane");t&&t.classList.contains("active")&&n(e)}),document.querySelectorAll('[data-bs-toggle="tab"]').forEach(e=>{e.addEventListener("shown.bs.tab",e=>{e=document.querySelector(e.target.getAttribute("data-bs-target")).querySelector(".swiper-design-parallax");e&&(i.has(e)?i.get(e).update():n(e))})})}}}function animateTextKaraoke(){$(".effect-karaoke").length<1||(gsap.registerPlugin(ScrollTrigger,SplitText),gsap.utils.toArray(".effect-karaoke").forEach(e=>{var t=new SplitText(e,{type:"words, chars",wordsClass:"word",charsClass:"char"});gsap.to(t.chars,{color:"#000",duration:.6,stagger:.05,ease:"power3.out",scrollTrigger:{trigger:e,start:"top 85%",end:"top 30%",scrub:!0}})}))}function svgSokoda(){gsap.registerPlugin(ScrollTrigger),document.querySelectorAll(".skoda-car").forEach(e=>{ScrollTrigger.create({trigger:e,start:"top 80%",onEnter:()=>{e.classList.add("active-svg")},once:!0})})}function footer(){$("footer .dropdown-info").on("click",function(){$(this).toggleClass("active");let t=$(this).find(".dropdown-content")[0];t.style.height&&"0px"!==t.style.height?(t.style.height=t.scrollHeight+"px",t.offsetHeight,t.style.height="0px"):(t.style.height=t.scrollHeight+"px",t.addEventListener("transitionend",function e(){t.style.height="auto",t.removeEventListener("transitionend",e)}))})}function sectionGallery(){GLightbox({selector:".glightbox",loop:!0,touchNavigation:!0})}function formBooking(){if(!($("#modalBooking").length<1)){let l=$("#modalBooking form"),e="./assets/js/index/province.json";var i=$("#header").data("assest");i&&(e=i+"/assets/main/js/province.json"),$.getJSON(e,function(e){e=e.map(e=>`<option value="${e.name}">${e.name}</option>`).join("");l.find('select[name="location"]').append(e)}).fail(function(){console.error("Không load được province.json")});let t=l.find("input[name='date']")[0];t&&new Lightpick({field:t,singleDate:!0,numberOfMonths:1,format:"DD/MM/YYYY",minDate:moment(),onSelect:function(e){try{e&&(t.value=e.format("DD/MM/YYYY"),t.classList.remove("error"))}catch(e){console.error("Lỗi trong Lightpick onSelect:",e)}}}),l.on("submit",function(e){e.preventDefault();var e=!0,t=($(this).find(".field").removeClass("error"),l.find("select[name='dongxe']").val().trim()),i=(""!==t&&"0"!==t||(l.find("select[name='dongxe']").closest(".field").addClass("error"),e=!1),l.find("input[name='fullname']").val().trim()),n=(""===i&&(l.find("input[name='fullname']").closest(".field").addClass("error"),e=!1),l.find("input[name='phone']").val().trim()),a=(""===n&&(l.find("input[name='phone']").closest(".field").addClass("error"),e=!1),l.find("input[name='email']").val().trim()),o=(""!==a&&/^\S+@\S+\.\S+$/.test(a)||(l.find("input[name='email']").closest(".field").addClass("error"),e=!1),l.find("select[name='location']").val().trim()),s=(""!==o&&"0"!==o||(l.find("select[name='location']").closest(".field").addClass("error"),e=!1),l.find("select[name='agency']").val().trim()),r=(""!==s&&"0"!==s||(l.find("select[name='agency']").closest(".field").addClass("error"),e=!1),l.find("input[name='date']").val());""===r&&(l.find("input[name='date']").closest(".field").addClass("error"),e=!1),e&&(e={dongxe:t,date:r,fullname:i,phone:n,email:a,location:o,agency:s},console.log(e),$.ajax({url:"https://script.google.com/macros/s/AKfycbw1BLYJRYJRuaYR3tBSNuvPsIPUc6mM3m6Oolrjnk9iwRqgmXLmOllii_x94tOQn-vx/exec",method:"POST",contentType:"application/json",data:JSON.stringify(e),beforeSend:function(){l.find("button[type='submit']").addClass("aloading")},success:function(e){l.find("button[type='submit']").removeClass("aloading"),alert("Gửi thành công!"),l[0].reset()},error:function(e,t,i){console.error(e.responseText),alert("Có lỗi xảy ra, vui lòng thử lại.")}}))}),$("input[name='phone']").on("input",function(){let e=this.value.replace(/\D/g,""),t=e=10<e.length?e.slice(0,10):e;4<e.length&&e.length<=7?t=e.slice(0,4)+" "+e.slice(4):7<e.length&&(t=e.slice(0,4)+" "+e.slice(4,7)+" "+e.slice(7)),this.value=t})}}function model3D(){if(!(document.querySelector(".skoda-car").length<1)){let e="./assets/images/white";var t=$("#header").data("assest");t&&(e=t+"/assets/images/white"),console.log(e),$("#skoda-modal-container").rollerblade({sensitivity:300,auto:!0,drag:!1,imageArray:((t,i)=>{var n=[];for(let e=1;e<=i;e++)n.push(`${t}/car_${e}.png`);return n})(e,24)})}}function headerDesktop(){document.addEventListener("DOMContentLoaded",function(){gsap.registerPlugin(ScrollToPlugin,ScrollTrigger),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=document.querySelector(this.getAttribute("href"));e&&gsap.to(window,{duration:1,scrollTo:{y:e,offsetY:200},ease:"power2.out"}),document.querySelectorAll('a[href^="#"]').forEach(e=>e.classList.remove("active")),this.classList.add("active")})}),document.querySelectorAll("section[id]").forEach(e=>{let t=document.querySelector(`a[href="#${e.id}"]`);t&&ScrollTrigger.create({trigger:e,start:"top 200px",end:"bottom 200px",onEnter:()=>{document.querySelectorAll('a[href^="#"]').forEach(e=>{e.classList.remove("active")}),t.classList.add("active")},onEnterBack:()=>{document.querySelectorAll('a[href^="#"]').forEach(e=>{e.classList.remove("active")}),t.classList.add("active")}})}),ScrollTrigger.refresh()})}function menuMobile(){if(!(992<window.innerWidth)){let t=document.querySelector(".header-ham"),i=document.querySelector(".header-sub-menu");var e=document.querySelectorAll(".header-sub-menu li a");t.addEventListener("click",()=>{t.classList.toggle("active"),i.classList.toggle("active")}),e.forEach(e=>{e.addEventListener("click",()=>{t.classList.remove("active"),i.classList.remove("active")})})}}lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{lenis.raf(1e3*e)}),gsap.ticker.lagSmoothing(0),headerDesktop(),document.addEventListener("DOMContentLoaded",function(){model3D()});let init=()=>{gsap.registerPlugin(ScrollTrigger),heroSwiper(),animateTextKaraoke(),svgSokoda(),sectionDesign(),sectionGallery(),formBooking(),footer(),menuMobile()},isLinkClicked=(preloadImages("img").then(()=>{init()}),!1);$("a").on("click",function(e){!this.href||this.href.match(/^#/)||this.href.match(/^javascript:/)||(isLinkClicked=!0,console.log("1"))}),$(window).on("beforeunload",function(){isLinkClicked||$(window).scrollTop(0),isLinkClicked=!1});